d3.parcoords=function(e){function t(e,t,n){d3.keys(t).forEach(function(r){e[r]=function(i){if(!arguments.length)return t[r];var a=t[r];return t[r]=i,O[r].call(y,{value:i,previous:a}),n[r].call(y,{value:i,previous:a}),e}})}function n(e,t){for(key in t)e[key]=t[key];return e}function r(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}function i(e){var t=d3.map(),n=d3.map();return b.data.forEach(function(t){var r=M[e](t[e]);n.has(r)||n.set(r,0);var i=n.get(r);n.set(r,i+1)}),b.data.forEach(function(r){b.dimensions.map(function(i){var a=M[e](r[e]);if(!t.has(a)){var s=d3.map();t.set(a,s)}t.get(a).has(i)||t.get(a).set(i,0);var o=t.get(a).get(i);o+=M[i](r[i])/n.get(a),t.get(a).set(i,o)})}),t}function a(e){for(var t=[],n=b.dimensions,r=n.length,i=.5,a=0;r>a;++a){var s=p(n[a]),o=M[n[a]](e[n[a]]);if(t.push($V([s,o])),r-1>a){var u=s+i*(p(n[a+1])-s),d=o+i*(M[n[a+1]](e[n[a+1]])-o);if(null!==b.bundleDimension){var l=b.clusterCentroids.get(M[b.bundleDimension](e[b.bundleDimension])).get(n[a]),c=b.clusterCentroids.get(M[b.bundleDimension](e[b.bundleDimension])).get(n[a+1]),h=.5*(l+c);d=h+(1-b.bundlingStrength)*(d-h)}t.push($V([u,d]))}}return t}function s(e){var t=e.length,n=b.smoothness,r=[];r.push(e[0]),r.push($V([e[0].e(1)+2*n*(e[1].e(1)-e[0].e(1)),e[0].e(2)]));for(var i=1;t-1>i;++i){var a=e[i],s=e[i-1],o=e[i+1],u=s.subtract(o);r.push(a.add(u.x(n))),r.push(a),r.push(a.subtract(u.x(n)))}return r.push($V([e[t-1].e(1)+2*n*(e[t-2].e(1)-e[t-1].e(1)),e[t-1].e(2)])),r.push(e[t-1]),r}function o(e,t){var n=a(e),r=s(n);t.moveTo(r[0].e(1),r[0].e(2));for(var i=1;i<r.length;i+=3){if(b.showControlPoints)for(var o=0;3>o;o++)t.fillRect(r[i+o].e(1),r[i+o].e(2),2,2);t.bezierCurveTo(r[i].e(1),r[i].e(2),r[i+1].e(1),r[i+1].e(2),r[i+2].e(1),r[i+2].e(2))}}function u(e,t,n){n.strokeStyle=d3.functor(b.color)(e,t),n.beginPath(),null===b.bundleDimension||0===b.bundlingStrength&&0==b.smoothness?l(e,n):o(e,n),n.stroke()}function d(e,t){t.clearRect(-1,-1,A()+2,k()+2),t.beginPath(),e.forEach(function(e){null===b.bundleDimension||0===b.bundlingStrength&&0==b.smoothness?l(e,t):o(e,t)}),t.stroke()}function l(e,t){b.dimensions.map(function(n,r){0==r?t.moveTo(p(n),M[n](e[n])):t.lineTo(p(n),M[n](e[n]))})}function c(e,t){return u(e,t,T.foreground)}function h(e,t){return u(e,t,T.highlight)}function f(e){y.svg.selectAll(".dimension");y.flip(e),d3.select(this.parentElement).transition().duration(1100).call(P.scale(M[e])),y.render(),D.shadows&&d(b.data,T.shadows)}function m(){var e=d3.event.deltaY;e=0>e?-5:e,e=e>0?5:e,b.dimensionTitleRotation+=e,y.svg.selectAll("text.label").attr("transform","translate(0,-5) rotate("+b.dimensionTitleRotation+")"),d3.event.preventDefault()}function g(e){b.brushed=e,w.brush.call(y,b.brushed),y.render()}function v(e){if(!arguments.length)return X.predicate;if(e=String(e).toUpperCase(),"AND"!==e&&"OR"!==e)throw"Invalid predicate "+e;return X.predicate=e,b.brushed=X.currentMode().selected(),y.render(),y}function p(e){var t=N[e];return null==t?E(e):t}var b={data:[],highlighted:[],dimensions:[],dimensionTitles:{},dimensionTitleRotation:0,types:{},brushed:!1,mode:"default",rate:20,width:600,height:300,margin:{top:24,right:0,bottom:12,left:0},color:"#069",composite:"source-over",alpha:.7,bundlingStrength:.5,bundleDimension:null,smoothness:.25,showControlPoints:!1,hideAxis:[]};n(b,e);var x,y=function(e){return e=y.selection=d3.select(e),b.width=e[0][0].clientWidth,b.height=e[0][0].clientHeight,["shadows","marks","foreground","highlight"].forEach(function(t){R[t]=e.append("canvas").attr("class",t)[0][0],T[t]=R[t].getContext("2d")}),y.svg=e.append("svg").attr("width",b.width).attr("height",b.height).append("svg:g").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),y},w=d3.dispatch.apply(this,["render","resize","highlight","brush","brushend","axesreorder"].concat(d3.keys(b))),A=function(){return b.width-b.margin.right-b.margin.left},k=function(){return b.height-b.margin.top-b.margin.bottom},D={brushable:!1,reorderable:!1,axes:!1,interactive:!1,shadows:!1,debug:!1},E=d3.scale.ordinal(),M={},N={},P=(d3.svg.line(),d3.svg.axis().orient("left").ticks(5)),T={},R={},O=d3.dispatch.apply(this,d3.keys(b)).on("composite",function(e){T.foreground.globalCompositeOperation=e.value}).on("alpha",function(e){T.foreground.globalAlpha=e.value}).on("width",function(){y.resize()}).on("height",function(){y.resize()}).on("margin",function(){y.resize()}).on("rate",function(e){S.rate(e.value)}).on("data",function(){D.shadows&&d(b.data,T.shadows)}).on("dimensions",function(){E.domain(b.dimensions),D.interactive&&y.render().updateAxes()}).on("bundleDimension",function(e){b.dimensions.length||y.detectDimensions(),b.dimensions[0]in M||y.autoscale(),"number"==typeof e.value?e.value<b.dimensions.length?b.bundleDimension=b.dimensions[e.value]:e.value<b.hideAxis.length&&(b.bundleDimension=b.hideAxis[e.value]):b.bundleDimension=e.value,b.clusterCentroids=i(b.bundleDimension)}).on("hideAxis",function(e){b.dimensions.length||y.detectDimensions(),y.dimensions(r(b.dimensions,e.value))});y.state=b,y.flags=D,t(y,b,w),d3.rebind(y,w,"on"),y.autoscale=function(){var e={date:function(e){var t=d3.extent(b.data,function(t){return t[e]?t[e].getTime():null});return t[0]===t[1]?d3.scale.ordinal().domain([t[0]]).rangePoints([k()+1,1]):d3.time.scale().domain(t).range([k()+1,1])},number:function(e){var t=d3.extent(b.data,function(t){return+t[e]});return t[0]===t[1]?d3.scale.ordinal().domain([t[0]]).rangePoints([k()+1,1]):d3.scale.linear().domain(t).range([k()+1,1])},string:function(e){var t={},n=[];return b.data.map(function(n){t[n[e]]=void 0===t[n[e]]?1:t[n[e]]+1}),n=Object.getOwnPropertyNames(t).sort(function(e,n){return t[e]-t[n]}),d3.scale.ordinal().domain(n).rangePoints([k()+1,1])}};return b.dimensions.forEach(function(t){M[t]=e[b.types[t]](t)}),b.hideAxis.forEach(function(t){M[t]=e[b.types[t]](t)}),E.rangePoints([0,A()],1),y.selection.selectAll("canvas").style("margin-top",b.margin.top+"px").style("margin-left",b.margin.left+"px").attr("width",A()+2).attr("height",k()+2),T.foreground.strokeStyle=b.color,T.foreground.lineWidth=1.4,T.foreground.globalCompositeOperation=b.composite,T.foreground.globalAlpha=b.alpha,T.highlight.lineWidth=3,T.shadows.strokeStyle="#dadada",this},y.scale=function(e,t){return M[e].domain(t),this},y.flip=function(e){return M[e].domain(M[e].domain().reverse()),this},y.commonScale=function(e,t){var n=t||"number";"undefined"==typeof e&&(e=!0);var r=b.dimensions.concat(b.hideAxis).filter(function(e){return b.types[e]==n});if(e){var i=d3.extent(r.map(function(e){return M[e].domain()}).reduce(function(e,t){return e.concat(t)}));r.forEach(function(e){M[e].domain(i)})}else r.forEach(function(e){M[e].domain(d3.extent(b.data,function(t){return+t[e]}))});return null!==b.bundleDimension&&y.bundleDimension(b.bundleDimension),this},y.detectDimensions=function(){return y.types(y.detectDimensionTypes(b.data)),y.dimensions(d3.keys(y.types())),this},y.toType=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},y.toTypeCoerceNumbers=function(e){return parseFloat(e)==e&&null!=e?"number":y.toType(e)},y.detectDimensionTypes=function(e){var t={};return d3.keys(e[0]).forEach(function(n){t[n]=y.toTypeCoerceNumbers(e[0][n])}),t},y.render=function(){return b.dimensions.length||y.detectDimensions(),b.dimensions[0]in M||y.autoscale(),y.render[b.mode](),w.render.call(this),this},y.render["default"]=function(){y.clear("foreground"),y.clear("highlight"),b.brushed?(b.brushed.forEach(c),b.highlighted.forEach(h)):(b.data.forEach(c),b.highlighted.forEach(h))};var S=d3.renderQueue(c).rate(50).clear(function(){y.clear("foreground"),y.clear("highlight")});y.render.queue=function(){b.brushed?(S(b.brushed),b.highlighted.forEach(h)):(S(b.data),b.highlighted.forEach(h))},y.shadows=function(){return D.shadows=!0,b.data.length>0&&d(b.data,T.shadows),this},y.axisDots=function(){var e=y.ctx.marks;return e.globalAlpha=d3.min([1/Math.pow(b.data.length,.5),1]),b.data.forEach(function(t){b.dimensions.map(function(n){e.fillRect(p(n)-.75,M[n](t[n])-.75,1.5,1.5)})}),this},y.clear=function(e){return T[e].clearRect(0,0,A()+2,k()+2),this},d3.rebind(y,P,"ticks","orient","tickValues","tickSubdivide","tickSize","tickPadding","tickFormat"),y.createAxes=function(){return x&&y.removeAxes(),x=y.svg.selectAll(".dimension").data(b.dimensions,function(e){return e}).enter().append("svg:g").attr("class","dimension").attr("transform",function(e){return"translate("+E(e)+")"}),x.append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(e){d3.select(this).call(P.scale(M[e]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-5) rotate("+b.dimensionTitleRotation+")",x:0,"class":"label"}).text(function(e){return e in b.dimensionTitles?b.dimensionTitles[e]:e}).on("dblclick",f).on("wheel",m),D.axes=!0,this},y.removeAxes=function(){return x.remove(),this},y.updateAxes=function(){var e=y.svg.selectAll(".dimension").data(b.dimensions);if(e.enter().append("svg:g").attr("class","dimension").attr("transform",function(e){return"translate("+p(e)+")"}).style("opacity",0).append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(e){d3.select(this).call(P.scale(M[e]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-5) rotate("+b.dimensionTitleRotation+")",x:0,"class":"label"}).text(String).on("dblclick",f).on("wheel",m),e.attr("opacity",0),e.select(".axis").transition().duration(1100).each(function(e){d3.select(this).call(P.scale(M[e]))}),e.select(".label").transition().duration(1100).text(String).attr("transform","translate(0,-5) rotate("+b.dimensionTitleRotation+")"),e.exit().remove(),x=y.svg.selectAll(".dimension"),x.transition().duration(1100).attr("transform",function(e){return"translate("+p(e)+")"}).style("opacity",1),y.svg.selectAll(".axis").transition().duration(1100).each(function(e){d3.select(this).call(P.scale(M[e]))}),D.shadows&&d(b.data,T.shadows),D.brushable&&y.brushable(),D.reorderable&&y.reorderable(),"None"!==y.brushMode()){var t=y.brushMode();y.brushMode("None"),y.brushMode(t)}return this},y.reorderable=function(){return x||y.createAxes(),x.style("cursor","move").call(d3.behavior.drag().on("dragstart",function(e){N[e]=this.__origin__=E(e)}).on("drag",function(e){N[e]=Math.min(A(),Math.max(0,this.__origin__+=d3.event.dx)),b.dimensions.sort(function(e,t){return p(e)-p(t)}),E.domain(b.dimensions),y.render(),x.attr("transform",function(e){return"translate("+p(e)+")"})}).on("dragend",function(e){for(var t=0,n=b.dimensions.indexOf(e),r=this,i=this.parentElement;null!=(r=r.previousElementSibling);)++t;t!==n&&(w.axesreorder.call(y,b.dimensions),t>n?i.insertBefore(this,i.children[n-1]):n+1<i.children.length?i.insertBefore(this,i.children[n+1]):i.appendChild(this)),delete this.__origin__,delete N[e],d3.select(this).transition().attr("transform","translate("+E(e)+")"),y.render(),D.shadows&&d(b.data,T.shadows)})),D.reorderable=!0,this},y.adjacent_pairs=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push([e[n],e[n+1]]);return t};var X={modes:{None:{install:function(){},uninstall:function(){},selected:function(){return[]}}},mode:"None",predicate:"AND",currentMode:function(){return this.modes[this.mode]}};return y.brushModes=function(){return Object.getOwnPropertyNames(X.modes)},y.brushMode=function(e){if(0===arguments.length)return X.mode;if(-1===y.brushModes().indexOf(e))throw"pc.brushmode: Unsupported brush mode: "+e;return e!==X.mode&&("None"!==X.mode&&y.brushReset(),X.modes[X.mode].uninstall(y),X.mode=e,X.modes[X.mode].install(),"None"===e?delete y.brushPredicate:y.brushPredicate=v),y},function(){function e(e){return!s[e].empty()}function t(){var t=b.dimensions.filter(e),n=t.map(function(e){return s[e].extent()});if(0===t.length)return b.data;var r={date:function(e,t,r){return n[r][0]<=e[t]&&e[t]<=n[r][1]},number:function(e,t,r){return n[r][0]<=e[t]&&e[t]<=n[r][1]},string:function(e,t,r){return n[r][0]<=M[t](e[t])&&M[t](e[t])<=n[r][1]}};return b.data.filter(function(e){switch(X.predicate){case"AND":return t.every(function(t,n){return r[b.types[t]](e,t,n)});case"OR":return t.some(function(t,n){return r[b.types[t]](e,t,n)});default:throw"Unknown brush predicate "+b.brushPredicate}})}function n(){var e={};return b.dimensions.forEach(function(t){var n=s[t];if(!n.empty()){var r=n.extent();r.sort(d3.ascending),e[t]=r}}),e}function r(e){var n=d3.svg.brush();return n.y(M[e]).on("brushstart",function(){d3.event.sourceEvent.stopPropagation()}).on("brush",function(){g(t())}).on("brushend",function(){w.brushend.call(y,b.brushed)}),s[e]=n,n}function i(){return b.brushed=!1,x&&(x.selectAll(".brush").each(function(e){d3.select(this).call(s[e].clear())}),y.render()),this}function a(){return x||y.createAxes(),x.append("svg:g").attr("class","brush").each(function(e){d3.select(this).call(r(e))}).selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30),y.brushExtents=n,y.brushReset=i,y}var s={};X.modes["1D-axes"]={install:a,uninstall:function(){x.selectAll(".brush").remove(),s={},delete y.brushExtents,delete y.brushReset},selected:t}}(),function(){function e(t,n){var r=y.selection.select("svg").select("g#strums"),i=t.dims.i,a=[t.p1,t.p2],s=r.selectAll("line#strum-"+i).data([t]),u=r.selectAll("circle#strum-"+i).data(a),d=d3.behavior.drag();s.enter().append("line").attr("id","strum-"+i).attr("class","strum"),s.attr("x1",function(e){return e.p1[0]}).attr("y1",function(e){return e.p1[1]}).attr("x2",function(e){return e.p2[0]}).attr("y2",function(e){return e.p2[1]}).attr("stroke","black").attr("stroke-width",2),d.on("drag",function(n,r){var i=d3.event;r+=1,t["p"+r][0]=Math.min(Math.max(t.minX+1,i.x),t.maxX),t["p"+r][1]=Math.min(Math.max(t.minY,i.y),t.maxY),e(t,r-1)}).on("dragend",o()),u.enter().append("circle").attr("id","strum-"+i).attr("class","strum"),u.attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}).attr("r",5).style("opacity",function(e,t){return void 0!==n&&t===n?.8:0}).on("mouseover",function(){d3.select(this).style("opacity",.8)}).on("mouseout",function(){d3.select(this).style("opacity",0)}).call(d)}function t(e){var t={i:-1,left:void 0,right:void 0};return b.dimensions.some(function(n,r){if(E(n)<e[0]){var i=b.dimensions[r+1];return t.i=r,t.left=n,t.right=i,!1}return!0}),void 0===t.left?(t.i=0,t.left=b.dimensions[0],t.right=b.dimensions[1]):void 0===t.right&&(t.i=b.dimensions.length-1,t.right=t.left,t.left=b.dimensions[b.dimensions.length-2]),t}function n(){return function(){var e=d3.mouse(l[0][0]),n=t(e),r={p1:e,dims:n,minX:E(n.left),maxX:E(n.right),minY:0,maxY:k()};c[n.i]=r,c.active=n.i,r.p1[0]=Math.min(Math.max(r.minX,e[0]),r.maxX),r.p1[1]=e[1]-b.margin.top,r.p2=r.p1.slice()}}function r(){return function(){var t=d3.event,n=c[c.active];n.p2[0]=Math.min(Math.max(n.minX+1,t.x),n.maxX),n.p2[1]=Math.min(Math.max(n.minY,t.y-b.margin.top),n.maxY),e(n,1)}}function i(e,t){var n=[e.p1[0]-e.minX,e.p1[1]-e.minX],r=[e.p2[0]-e.minX,e.p2[1]-e.minX],i=1-t/n[0],a=n[1]*(1-i),s=1-t/r[0],o=r[1]*(1-s);return function(e){var t=e[0],n=e[1],r=i*t+a,u=s*t+o;return n>Math.min(r,u)&&n<Math.max(r,u)?!0:!1}}function a(){function e(e,t){var n=c[t],r=i(n,c.width(t)),a=n.dims.left,s=n.dims.right,o=M[a],u=M[s],d=[o(e[a])-n.minX,u(e[s])-n.minX];return r(d)}var t=Object.getOwnPropertyNames(c),n=b.data;return t=t.filter(function(e){return!isNaN(e)}),0===t.length?n:n.filter(function(n){switch(X.predicate){case"AND":return t.every(function(t){return e(n,t)});case"OR":return t.some(function(t){return e(n,t)});default:throw"Unknown brush predicate "+b.brushPredicate}})}function s(){var e=c[c.active],t=y.selection.select("svg").select("g#strums");delete c[c.active],c.active=void 0,t.selectAll("line#strum-"+e.dims.i).remove(),t.selectAll("circle#strum-"+e.dims.i).remove()}function o(){return function(){var e=b.data,t=c[c.active];t&&t.p1[0]===t.p2[0]&&t.p1[1]===t.p2[1]&&s(c),e=a(c),c.active=void 0,b.brushed=e,y.render(),w.brushend.call(y,b.brushed)}}function u(e){return function(){var t=Object.getOwnPropertyNames(e).filter(function(e){return!isNaN(e)});t.forEach(function(t){e.active=t,s(e)}),o(e)()}}function d(){var e=d3.behavior.drag();c.active=void 0,c.width=function(e){var t=c[e];return void 0===t?void 0:t.maxX-t.minX},y.on("axesreorder.strums",function(){function e(e,t){var n=b.dimensions.length;return b.dimensions.some(function(r,i){return r===e?n>i+i&&b.dimensions[i+1]===t:!1})}var t=Object.getOwnPropertyNames(c).filter(function(e){return!isNaN(e)});t.length>0&&(t.forEach(function(t){var n=c[t].dims;c.active=t,e(n.left,n.right)||s(c)}),o(c)())}),y.selection.select("svg").append("g").attr("id","strums").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),y.brushReset=u(c),e.on("dragstart",n(c)).on("drag",r(c)).on("dragend",o(c)),l=y.selection.select("svg").insert("rect","g#strums").attr("id","strum-events").attr("x",b.margin.left).attr("y",b.margin.top).attr("width",A()).attr("height",k()+2).style("opacity",0).call(e)}var l,c={};X.modes["2D-strums"]={install:d,uninstall:function(){y.selection.select("svg").select("g#strums").remove(),y.selection.select("svg").select("rect#strum-events").remove(),y.on("axesreorder.strums",void 0),delete y.brushReset,l=void 0},selected:a}}(),y.interactive=function(){return D.interactive=!0,this},y.xscale=E,y.yscale=M,y.ctx=T,y.canvas=R,y.g=function(){return x},y.resize=function(){return y.selection.select("svg").attr("width",b.width).attr("height",b.height),y.svg.attr("transform","translate("+b.margin.left+","+b.margin.top+")"),D.brushable&&y.brushReset(),y.autoscale(),x&&y.createAxes(),D.shadows&&d(b.data,T.shadows),D.brushable&&y.brushable(),D.reorderable&&y.reorderable(),w.resize.call(this,{width:b.width,height:b.height,margin:b.margin}),this},y.highlight=function(e){return 0===arguments.length?b.highlighted:(b.highlighted=e,y.clear("highlight"),d3.select(R.foreground).classed("faded",!0),e.forEach(h),w.highlight.call(this,e),this)},y.unhighlight=function(){return b.highlighted=[],y.clear("highlight"),d3.select(R.foreground).classed("faded",!1),this},y.intersection=function(e,t,n,r){return{x:((e.x*t.y-e.y*t.x)*(n.x-r.x)-(e.x-t.x)*(n.x*r.y-n.y*r.x))/((e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x)),y:((e.x*t.y-e.y*t.x)*(n.y-r.y)-(e.y-t.y)*(n.x*r.y-n.y*r.x))/((e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x))}},y.version="0.6.0",y.toString=function(){return"Parallel Coordinates: "+b.dimensions.length+" dimensions ("+d3.keys(b.data[0]).length+" total) , "+b.data.length+" rows"},y},d3.renderQueue=function(e){var t=[],n=10,r=function(){},i=0,a=function(e){e&&a.data(e),a.invalidate(),r(),a.render()};return a.render=function(){function r(){if(!s)return!0;if(i>t.length)return!0;for(var r=Math.min(i+n,t.length),a=i;r>a;a++)e(t[a],a);i+=n}i=0;var s=!0;a.invalidate=function(){s=!1},d3.timer(r)},a.data=function(e){return a.invalidate(),t=e.slice(0),a},a.rate=function(e){return arguments.length?(n=e,a):n},a.remaining=function(){return t.length-i},a.clear=function(e){return arguments.length?(r=e,a):(r(),a)},a.invalidate=function(){},a};
